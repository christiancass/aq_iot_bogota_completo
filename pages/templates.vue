<template>
    <div>
      <!-- CONFIGURACIÓN DE WIDGET-->
      <div class="row">
        <card>
          <div slot="header">
            <h4 class="card-title">Lista de widgets</h4>
          </div>
  
          <div class="row">
            <!-- SELECTOR DE WIDGET Y FORMULARIO -->
            <div class="col-6">
              <!-- WIDGETS SELECTOR -->
              <el-select
                v-model="widgetType"
                class="select-info"
                placeholder="Seleccione un Widget"
                style="width: 100%;"
              >
                <el-option
                  class="text-dark"
                  value="numberchart"
                  label="Widget de gráfico"
                >
                </el-option>
                <el-option
                  class="text-dark"
                  value="indicator"
                  label="Widget de indicador booleano"
                >
                </el-option>
                <el-option
                  class="text-dark"
                  value="mapa"
                  label="Widget de Mapa"
                ></el-option>
                <el-option
                  class="text-dark"
                  value="switch"
                  label="Widget de switch"
                ></el-option>
                <el-option
                  class="text-dark"
                  value="button"
                  label="Widget de botón"
                ></el-option>
              </el-select>
  
              <br />
              <br />
  
              <!-- FORMS NUMBER CHART TYPE -->
              <div v-if="widgetType == 'numberchart'">
                <base-input
                  v-model="ncConfig.variableFullName"
                  label="Nombre de variable"
                  type="text"
                >
                </base-input>
  
                <base-input v-model="ncConfig.unit" label="Unidad" type="text">
                </base-input>
  
                <base-input
                  v-model.number="ncConfig.decimalPlaces"
                  label="Número de décimas"
                  type="number"
                >
                </base-input>
  
                <base-input
                  v-model="ncConfig.icon"
                  label="Ícono"
                  type="text"
                ></base-input>
  
                <br />
  
                <base-input
                  v-model.number="ncConfig.variableSendFreq"
                  label="Frecuencia de muestreo"
                  type="number"
                ></base-input>
  
                <br />
  
                <base-input
                  v-model.number="ncConfig.chartTimeAgo"
                  label="Tiempo de retroceso (mins)"
                  type="number"
                ></base-input>
  
                <br />
  
                <el-select
                  v-model="ncConfig.class"
                  class="select-info"
                  placeholder="Select Class"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-success"
                    value="success"
                    label="Verde"
                  ></el-option>
                  <el-option
                    class="text-primary"
                    value="primary"
                    label="Violeta"
                  ></el-option>
                  <el-option
                    class="text-warning"
                    value="warning"
                    label="Amarillo"
                  ></el-option>
                  <el-option
                    class="text-danger"
                    value="danger"
                    label="Rojo"
                  ></el-option>
                </el-select>
  
                <br /><br /><br />
  
                <el-select
                  v-model="ncConfig.column"
                  class="select-info"
                  placeholder="Select Column Width"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-dark"
                    value="col-3"
                    label="col-3"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-4"
                    label="col-4"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-5"
                    label="col-5"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-6"
                    label="col-6"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-7"
                    label="col-7"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-8"
                    label="col-8"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-9"
                    label="col-9"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-10"
                    label="col-10"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-11"
                    label="col-11"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-12"
                    label="col-12"
                  ></el-option>
                </el-select>
  
                <br /><br />
              </div>
  
              <!-- FORM SWITCH TYPE -->
              <div v-if="widgetType == 'switch'">
                <base-input
                  v-model="iotSwitchConfig.variableFullName"
                  label="Nombre"
                  type="text"
                >
                </base-input>
  
                <base-input
                  v-model="iotSwitchConfig.icon"
                  label="Ícono"
                  type="text"
                ></base-input>
  
                <br />
                <p>Color</p>
                <el-select
                  v-model="iotSwitchConfig.class"
                  class="select-success"
                  placeholder="Select Class"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-success"
                    value="success"
                    label="Verde"
                  ></el-option>
                  <el-option
                    class="text-primary"
                    value="primary"
                    label="Violeta"
                  ></el-option>
                  <el-option
                    class="text-warning"
                    value="warning"
                    label="Amarillo"
                  ></el-option>
                  <el-option
                    class="text-danger"
                    value="danger"
                    label="Rojo"
                  ></el-option>
                </el-select>
  
                <br /><br />
                <p>Tamaño en pantalla</p>
                <el-select
                  v-model="iotSwitchConfig.column"
                  class="select-success"
                  placeholder="Select Column Width"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-dark"
                    value="col-3"
                    label="col-3"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-4"
                    label="col-4"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-5"
                    label="col-5"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-6"
                    label="col-6"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-7"
                    label="col-7"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-8"
                    label="col-8"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-9"
                    label="col-9"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-10"
                    label="col-10"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-11"
                    label="col-11"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-12"
                    label="col-12"
                  ></el-option>
                </el-select>
  
                <br /><br />
              </div>
  
              <!-- FORM BUTTON TYPE -->
              <div v-if="widgetType == 'button'">
                <base-input
                  v-model="configButton.variableFullName"
                  label="Nombre"
                  type="text"
                >
                </base-input>
  
                <base-input
                  v-model="configButton.message"
                  label="Mensaje a enviar"
                  type="text"
                >
                </base-input>
  
                <base-input
                  v-model="configButton.text"
                  label="Texto en botón"
                  type="text"
                >
                </base-input>
  
                <base-input
                  v-model="configButton.icon"
                  label="Ícono"
                  type="text"
                ></base-input>
  
                <br />
                <p>Color</p>
                <el-select
                  v-model="configButton.class"
                  class="select-success"
                  placeholder="Select Class"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-success"
                    value="success"
                    label="Verde"
                  ></el-option>
                  <el-option
                    class="text-primary"
                    value="primary"
                    label="Violeta"
                  ></el-option>
                  <el-option
                    class="text-warning"
                    value="warning"
                    label="Amarillo"
                  ></el-option>
                  <el-option
                    class="text-danger"
                    value="danger"
                    label="Rojo"
                  ></el-option>
                </el-select>
  
                <br /><br />
                <p>Tamaño en pantalla</p>
                <el-select
                  v-model="configButton.column"
                  class="select-success"
                  placeholder="Select Column Width"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-dark"
                    value="col-3"
                    label="col-3"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-4"
                    label="col-4"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-5"
                    label="col-5"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-6"
                    label="col-6"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-7"
                    label="col-7"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-8"
                    label="col-8"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-9"
                    label="col-9"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-10"
                    label="col-10"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-11"
                    label="col-11"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-12"
                    label="col-12"
                  ></el-option>
                </el-select>
  
                <br /><br />
              </div>
  
              <!-- FORM INDICATOR TYPE -->
              <div v-if="widgetType == 'indicator'">
  
                <base-input
                  v-model="iotIndicatorConfig.variableFullName"
                  label="Nombre"
                  type="text"
                >
                </base-input>
  
                <base-input
                  v-model="iotIndicatorConfig.icon"
                  label="Ícono"
                  type="text"
                ></base-input>
  
                <br />
  
                <base-input
                  v-model="iotIndicatorConfig.variableSendFreq"
                  label="Frecuencia de muestreo"
                  type="text"
                ></base-input>
  
                <br />
                <p>Color</p>
                <el-select
                  v-model="iotIndicatorConfig.class"
                  class="select-info"
                  placeholder="Select Class"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-success"
                    value="success"
                    label="Verde"
                  ></el-option>
                  <el-option
                    class="text-primary"
                    value="primary"
                    label="Violeta"
                  ></el-option>
                  <el-option
                    class="text-warning"
                    value="warning"
                    label="Amarillo"
                  ></el-option>
                  <el-option
                    class="text-danger"
                    value="danger"
                    label="Rojo"
                  ></el-option>
                </el-select>
  
                <br /><br />
                <p>Tamaño en pantalla</p>
                <el-select
                  v-model="iotIndicatorConfig.column"
                  class="select-info"
                  placeholder="Select Column Width"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-dark"
                    value="col-3"
                    label="col-3"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-4"
                    label="col-4"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-5"
                    label="col-5"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-6"
                    label="col-6"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-7"
                    label="col-7"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-8"
                    label="col-8"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-9"
                    label="col-9"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-10"
                    label="col-10"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-11"
                    label="col-11"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-12"
                    label="col-12"
                  ></el-option>
                </el-select>
  
                <br /><br />
              </div>
  
              <!-- FORM MAP TYPE -->
              <div v-if="widgetType == 'mapa'">
  
                <base-input
                  v-model="iotMapConfig.variableFullName"
                  label="Nombre"
                  type="text"
                >
                </base-input>
                <br />
  
                <base-input
                  v-model="iotMapConfig.variableSendFreq"
                  label="Frecuencia de muestreo"
                  type="text"
                ></base-input>
  
                <br />
                <p>Tamaño en pantalla</p>
                <el-select
                  v-model="iotMapConfig.column"
                  class="select-info"
                  placeholder="Select Column Width"
                  style="width: 100%;"
                >
                  <el-option
                    class="text-dark"
                    value="col-3"
                    label="pequeño"
                  ></el-option>           
                  <el-option
                    class="text-dark"
                    value="col-6"
                    label="media"
                  ></el-option>
                  <el-option
                    class="text-dark"
                    value="col-12"
                    label="completa"
                  ></el-option>
                </el-select>
  
                <br /><br />
              </div>
            </div>
  
            <!-- WIDGET PREVIEW -->
            <div class="col-6">
              <Rtnumberchart
                v-if="widgetType == 'numberchart'"
                :config="ncConfig"
              ></Rtnumberchart>
              <Iotswitch
                v-if="widgetType == 'switch'"
                :config="iotSwitchConfig"
              ></Iotswitch>
              <Iotbutton
                v-if="widgetType == 'button'"
                :config="configButton"
              ></Iotbutton>
              <Iotindicator
                v-if="widgetType == 'indicator'"
                :config="iotIndicatorConfig"
              ></Iotindicator>
               <IotMap
                v-if="widgetType == 'mapa'"
                :config="iotMapConfig"
              ></IotMap>
             
            </div>
          </div>
  
          <!-- ADD WIDGET BUTTON -->
          <div class="row pull-right">
            <div class="col-12">
              <base-button
                native-type="submit"
                type="info"
                class="mb-3"
                size="lg"
                @click="addNewWidget()"
              >
                Agregar widget
              </base-button>
            </div>
          </div>
        </card>
      </div> 
  
      <!-- DASHBOARD PREVIEW -->
      <div class="row">
        <div
          v-for="(widget, index) in widgets"
          :key="index"
          :class="[widget.column]"
        >
          <i
            aria-hidden="true"
            class="fa fa-trash text-warning pull-right"
            @click="deleteWidget(index)"
            style="margin-bottom: 10px;"
          ></i>
  
          <Rtnumberchart
            v-if="widget.widget == 'numberchart'"
            :config="widget"
          ></Rtnumberchart>
  
          <Iotswitch
            v-if="widget.widget == 'switch'"
            :config="widget"
          ></Iotswitch>
  
          <Iotbutton
            v-if="widget.widget == 'button'"
            :config="widget"
          ></Iotbutton>
  
          <Iotindicator
            v-if="widget.widget == 'indicator'"
            :config="widget"
          ></Iotindicator>
      
          <IotMap
            v-if="widget.widget == 'mapa'"
            :config="widget"
          ></IotMap>
        
  
        </div>
      </div>
  
      <!-- SAVE TEMPLATE FORM-->
      <div class="row" >
        <card>
          <div slot="header">
            <h4 class="card-title">Guardar plantilla</h4>
          </div>
  
          <div class="row">
            <base-input
              class="col-4"
              v-model="templateName"
              label="Nombre de plantilla"
              type="text"
            >
            </base-input>
  
            <base-input
              class="col-8"
              v-model="templateDescription"
              label="Descripción"
              type="text"
            >
            </base-input>
          </div>
  
          <br /><br />
  
          <div class="row">
            <div class="col-12">
              <base-button
                native-type="submit"
                type="info"
                class="mb-3 pull-right"
                size="lg"
                @click="saveTemplate()"
                :disabled="widgets.length == 0"
              >
                Guardar
              </base-button>
            </div>
          </div>
        </card>
      </div>
  
      <!-- TEMPLATES TABLE -->
      <div class="row">
        <card card-body-classes="table-full-width">
            <div slot="header">
                <h4 class="card-title">Plantillas</h4>
            </div>   
            <div class="row">
                <el-table :data="templates"
                header-cell-class-name="table-transparent"
            header-row-class-name="table-transparent"
            row-class-name="table-transparent">
                    <el-table-column min-width="50" label="#" align="center">
                        <div class="photo" slot-scope="{ row, $index }">
                            {{ $index + 1 }}
                        </div>
                    </el-table-column>
                <el-table-column prop="name" label="Nombre"></el-table-column>
  
              <el-table-column
                prop="description"
                label="Descripción"
              ></el-table-column>
  
              <el-table-column
                prop="widgets.length"
                label="Widgets"
              ></el-table-column>
  
              <el-table-column header-align="right" align="right" label="Acción">
                <div
                  slot-scope="{ row, $index }"
                  class="text-right table-actions"
                >
                  <el-tooltip
                    content="Delete"
                    effect="light"
                    :open-delay="300"
                    placement="top"
                  >
                    <base-button
                      @click="deleteTemplate(row)"
                      type="danger"
                      icon
                      size="sm"
                      class="btn-link"
                    >
                      <i class="tim-icons icon-simple-remove "></i>
                    </base-button>
                  </el-tooltip>
                </div>
              </el-table-column>
            </el-table>
          </div>
        </card>
      </div>
  
  
    </div>
  </template>
  
  <script>
  
  import { Table, TableColumn } from "element-ui";
  import { Select, Option } from "element-ui";
  import Iotindicator from '@/components/Widgets/Iotindicator.vue/'
  import Iotbutton from '@/components/Widgets/Iotbutton.vue/'
  import Iotswitch from '@/components/Widgets/Iotswitch.vue/'
  import IotMap from '@/components/Widgets/IotMap.vue/'
  import Rtnumberchart from '@/components/Widgets/Rtnumberchart.vue/'
  import Json from '@/components/Json/'
  
  export default {
    
      components: {
          [Table.name]: Table,
          [TableColumn.name]: TableColumn,
          [Option.name]: Option,
          [Select.name]: Select,
          Iotindicator,
          Iotbutton,
          Iotswitch,
          Rtnumberchart,
          IotMap,
          Json
      },
  
  
      data() {
      return {
        widgets: [],
        templates: [],
        widgetType: "",
        templateName: "",
        templateDescription: "",
  
  
        ncConfig: {
          userId: "sampleuserid",
          selectedDevice: {
            name: "Home",
            dId: "8888"
          },
          variableFullName: "temperature",
          variable: "varname",
          variableType: "input",
          variableSendFreq: "30",
          unit: "Watts",
          class: "success",
          column: "col-12",
          decimalPlaces: 2,
          widget: "numberchart",
          icon: "fa-sun",
          chartTimeAgo: 60,
          demo: true
        },
  
        iotSwitchConfig: {
          userId: "userid",
          selectedDevice: {
            name: "Home",
            dId: "8888"
          },
          variableFullName: "Luz",
          variable: "varname",
          variableType: "output",
          class: "danger",
          widget: "switch",
          icon: "fa-bath",
          column: "col-6"
        },
  
  
        iotIndicatorConfig: {
          userId: "userid",
          selectedDevice: {
            name: "Home",
            dId: "8888"
          },
          variableFullName: "temperature",
          variable: "varname",
          variableType: "input",
          variableSendFreq: "30",
          class: "success",
          widget: "indicator",
          icon: "fa-bath",
          column: "col-6"
        },
  
        iotMapConfig: {
          userId: "userid",
          selectedDevice: {
            name: "Home",
            dId: "8888"
          },
          variableFullName: "system",
          variable: "varname",
          variableType: "input",
          variableSendFreq: "20",
          class: "success",
          widget: "mapa",
          icon: "fa-map-maker-alt",
          column: "col-6"
        },
  
  
        configButton: {
          userId: "userid",
          selectedDevice: {
            name: "Home",
            dId: "8888",
            templateName: "Power Sensor",
            templateId: "984237562348756ldksjfh",
            saverRule: false
          },
          variableFullName: "Pump",
          variable: "var1",
          variableType: "input",
          icon: "fa-sun",
          column: "col-4",
          widget: "button",
          class: "danger",
          message: "{'fanstatus': 'stop'}"
        },
  
  
      };
    },
  
    
  
    methods: {
      //Get Templates
        
  
      //Save Template
      
  
      //Delete Template
      
  
      //Add Widget
      makeid(length) {
        let result = "";
        let  characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        let charactersLength = characters.length;
        for (let i = 0; i < length; i++) {
            result += characters.charAt(
            Math.floor(Math.random() * charactersLength)
            );
        }
        return result;
        },
        addNewWidget() {
            if (this.widgetType == "numberchart") {
                this.ncConfig.variable = this.makeid(10);
                this.widgets.push(JSON.parse(JSON.stringify(this.ncConfig)));
            }

            if (this.widgetType == "switch") {
                this.iotSwitchConfig.variable = this.makeid(10);
                this.widgets.push(JSON.parse(JSON.stringify(this.iotSwitchConfig)));
            }

            if (this.widgetType == "button") {
                this.configButton.variable = this.makeid(10);
                this.widgets.push(JSON.parse(JSON.stringify(this.configButton)));
            }

            if (this.widgetType == "indicator") {
                this.iotIndicatorConfig.variable = this.makeid(10);
                this.widgets.push(JSON.parse(JSON.stringify(this.iotIndicatorConfig)));
            }

            if (this.widgetType == "mapa") {
                this.iotMapConfig.variable = this.makeid(10);
                this.widgets.push(JSON.parse(JSON.stringify(this.iotMapConfig)));
            }
        },
      
  
      //Delete Widget
        deleteWidget(index) {
            this.widgets.splice(index, 1);
        },
      

    }
  };
  </script>
  <style>
    .table-transparent {
    background-color: transparent !important;
  }
  </style>